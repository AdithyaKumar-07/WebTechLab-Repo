<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intelligent Shopping Cart</title>
</head>
<body>

<div class="container">
    <h2>Intelligent Cart</h2>
    <div id="cart-list">
    </div>

    <div class="coupon-box">
        <input type="text" id="coupon-input" placeholder="Try code: SAVE20">
        <button class="btn-apply" onclick="handleCoupon()">Apply</button>
    </div>

    <div class="summary">
        <div>Subtotal: <span id="subtotal">0.00/-</span></div>
        <div class="discount-line">Discounts: -<span id="discount-total">0.00/-</span></div>
        <hr>
        <div style="font-size: 1.2rem; font-weight: bold;">Total: <span id="final-total">0.00/-</span></div>
    </div>
    <p style="font-size: 0.8rem; color: #64748b; margin-top: 10px;">
        * Rules: 10% off over 500/- | 20% off Electronics (3+ items) | Happy Hour 5/- off (2PM-4PM)
    </p>
</div>

<script>
    // 1. Initial State (Data Array)
    let cart = [
        { id: 1, name: "Premium Laptop", price: 1200, quantity: 1, category: "Electronics" },
        { id: 2, name: "Wireless Mouse", price: 50, quantity: 2, category: "Electronics" },
        { id: 3, name: "Design Journal", price: 15, quantity: 10, category: "Stationery" }
    ];

    let activeCouponDiscount = 0;

    // 2. Render Function (Real-time display)
    function renderCart() {
        const cartList = document.getElementById('cart-list');
        cartList.innerHTML = '';

        cart.forEach((item, index) => {
            cartList.innerHTML += `
                <div class="product-item">
                    <div>
                        <strong>${item.name}</strong><br>
                        <small>${item.category} - ${item.price}/-</small>
                    </div>
                    <div class="controls">
                        <input type="number" value="${item.quantity}" min="1" 
                               onchange="updateQty(${index}, this.value)">
                        <button class="btn-remove" onclick="removeItem(${index})">âœ•</button>
                    </div>
                </div>
            `;
        });
        calculateTotals();
    }

    // 3. Logic Engine (Rule-Driven Discounts)
    function calculateTotals() {
        let subtotal = cart.reduce((acc, item) => acc + (item.price * item.quantity), 0);
        let totalDiscount = 0;

        // Rule A: Bulk Discount (10% off if subtotal > $500)
        if (subtotal > 500) {
            totalDiscount += subtotal * 0.10;
        }

        // Rule B: Category-based (20% off Electronics if purchasing 3 or more electronics items)
        const electronics = cart.filter(i => i.category === "Electronics");
        const elecQty = electronics.reduce((acc, i) => acc + i.quantity, 0);
        if (elecQty >= 3) {
            const elecSubtotal = electronics.reduce((acc, i) => acc + (i.price * i.quantity), 0);
            totalDiscount += elecSubtotal * 0.20;
        }

        // Rule C: Time-based (Happy Hour: Extra $5 off between 2 PM and 4 PM)
        const currentHour = new Date().getHours();
        if (currentHour >= 14 && currentHour <= 16) {
            totalDiscount += 5;
        }

        // Apply any validated coupon discount
        totalDiscount += activeCouponDiscount;

        // Update DOM
        document.getElementById('subtotal').innerText = `${subtotal.toFixed(2)}/-`;
        document.getElementById('discount-total').innerText = `${totalDiscount.toFixed(2)}/-`;
        document.getElementById('final-total').innerText = `${Math.max(0, subtotal - totalDiscount).toFixed(2)}/-`;
    }

    // 4. Update & Remove Actions
    function updateQty(index, newQty) {
        cart[index].quantity = parseInt(newQty) || 0;
        renderCart();
    }

    function removeItem(index) {
        cart.splice(index, 1);
        renderCart();
    }

    // 5. String Methods (Coupon Validation)
    function handleCoupon() {
        const input = document.getElementById('coupon-input').value.trim().toUpperCase();
        
        // Validation: Must start with "SAVE", followed by 2 digits (e.g., SAVE20)
        if (input.startsWith("SAVE") && input.length === 6) {
            const amount = parseInt(input.slice(4)); // Extract numeric part
            if (!isNaN(amount)) {
                activeCouponDiscount = amount;
                alert(`Coupon applied: ${amount}/- off!`);
                renderCart();
                return;
            }
        }
        alert("Invalid coupon code. Try SAVE20");
    }

    // Initial Load
    renderCart();
</script>

</body>
</html>
